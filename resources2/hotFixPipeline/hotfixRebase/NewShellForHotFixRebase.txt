#!/bin/bash

if [ "$ApprovedByGovernment" == "NO" ] ;
then
  if [ -z "$ReasonForNOApproval" ];
  then
    # script to send simple email
    # email subject
    SUBJECT="ATTENTION: UNAUTHORIZED HOTFIX BEING CREATED BY $emailAddress"
    echo $SUBJECT "Sending email to government......did not provide justification or seek government approval"
    # Email To ?
    EMAIL="David.A.Blair@uscis.dhs.gov, Rafaa.M.Abdalla@uscis.dhs.gov, Raghavender.Sriram@uscis.dhs.gov, Erika.R.Botts@uscis.dhs.gov, Marilyn.D.Teunis@uscis.dhs.gov, #ELIS2-SKynet@uscis.dhs.gov, #ELISReleaseCaptain@uscis.dhs.gov, #ELIS2TechLeads@uscis.dhs.gov "
    # send an email using /bin/mail
    /bin/mail -r "#ELIS2-CI@uscis.dhs.gov" -s "$SUBJECT" "$EMAIL" <<EOF
All,

     ALERT: $emailAddress attempted a rebase in the intention of creating a HOTFIX from tag $GIT_TAG without the following:
     - Justification
     - Government Approval
EOF
    exit 1
  fi
fi



git reset --hard ${GIT_TAG}
git checkout Release_Hotfixes
git reset --hard ${GIT_TAG}


  # script to send simple email
    # email subject
    SUBJECT="FYI: A HOTFIX REBASE HAS BEEN INITIATED BY $emailAddress Of ELIS VERSION $GIT_TAG"
    echo $SUBJECT
    # Email To ?
    EMAIL="David.A.Blair@uscis.dhs.gov, Rafaa.M.Abdalla@uscis.dhs.gov, Raghavender.Sriram@uscis.dhs.gov, Erika.R.Botts@uscis.dhs.gov, Marilyn.D.Teunis@uscis.dhs.gov, #ELIS2-SKynet@uscis.dhs.gov, #ELISReleaseCaptain@uscis.dhs.gov, #ELIS2TechLeads@uscis.dhs.gov "
    # send an email using /bin/mail
    /bin/mail -r "#ELIS2-CI@uscis.dhs.gov" -s "$SUBJECT" "$EMAIL" <<EOF
All,

     FYI: The Hotfix Branch has been rebased from ELIS Release Version $GIT_TAG by $emailAddress

     ${BUILD_URL}

EOF
